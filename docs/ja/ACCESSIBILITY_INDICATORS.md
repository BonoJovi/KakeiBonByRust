# アクセシビリティインジケータ実装

## 概要

視力の弱い（ロービジョン）ユーザーにやさしいアプリケーションを目指し、視覚的にわかりやすい一貫したインジケータシステムを実装しました。

## 設計理念

### ユニバーサルデザインの原則

1. **視認性の向上** - 大きく、はっきりとしたインジケータ
2. **一貫性** - すべての入力・選択項目で同じ方式を採用
3. **直感性** - 視覚的にわかりやすい表現（塗りつぶしの丸）
4. **色覚バリアフリー** - 黒い縁取りで色に依存せず形状のコントラストで認識可能

### ターゲットユーザー

- 視力の弱い方（ロービジョンの方）
- 高齢者
- 認知機能の低下がある方
- 色覚異常（色弱・色盲）の方
- すべてのユーザー（ユニバーサルデザイン）

## 実装内容

### 1. 言語メニューの選択インジケータ

#### 視覚的表現

- **非選択状態**: 空の丸（○）- グレーの枠線（#666）
- **選択状態**: 塗りつぶしの丸（●）- 緑色の塗りつぶし + 黒い縁取り

#### デザイン理由

黒い縁取りを追加することで：
- 色覚異常（色弱・色盲）の方でも形状のコントラストで認識可能
- 背景色と緑色の区別が難しい場合でも、黒い輪郭で明確に視認できる
- WCAGのコントラスト比基準をより確実に満たす

### 2. フォーム入力フィールドのフォーカスインジケータ

#### 視覚的表現

- **フォーカス時**: フィールドの左側に大きな緑の塗りつぶし丸（●）+ 黒い縁取りを表示
- **ボーダー**: 緑色に変更
- **シャドウ**: 緑色の柔らかい影を追加

#### デザイン理由

黒い縁取りを追加することで：
- 色覚異常の方でも明確に認識可能
- 白やグレーの背景に対して常に高いコントラストを維持

#### 技術実装

Flexboxを使用した完璧な中央配置：

```css
.form-group .input-wrapper {
    display: flex;
    align-items: center;  /* 垂直中央配置 */
    gap: 0.5rem;
}

.form-group.active .input-wrapper::before {
    content: '●';
    font-size: 2em;
    flex-shrink: 0;
}
```

### 3. ボタンのフォーカスインジケータ

#### 視覚的表現

- **フォーカス時**: ボタンの下部に濃い緑の下線を表示
- **アウトライン**: 3pxの緑のアウトラインを追加

## 色の選択理由

### 緑色 (#4CAF50) を選択した理由

1. **コントラスト**: 白や薄いグレーの背景に対して高いコントラスト
2. **ポジティブな意味**: 「進む」「OK」「選択」を表す一般的な色
3. **アクセシビリティ**: WCAG 2.1のコントラスト比基準を満たす
4. **一貫性**: ボタンの主色として一般的に使用されている

### 黒い縁取りを追加した理由

1. **色覚バリアフリー**: 色に依存せず形状で認識可能
2. **コントラスト向上**: 背景色に関わらず常に明確な境界線
3. **視認性**: 緑と背景の区別が難しい場合でも黒い輪郭で認識可能
4. **WCAG準拠**: より確実にコントラスト比基準を満たす

### 色覚シミュレーション

以下の色覚タイプでもインジケータを認識可能：

- **1型色覚（P型、赤色弱）**: 黒い縁取りで認識
- **2型色覚（D型、緑色弱）**: 黒い縁取りで認識
- **3型色覚（T型、青色弱）**: 緑と黒のコントラストで認識
- **全色盲**: 輝度の違いと黒い縁取りで認識

### サイズの選択

- **丸のサイズ**: 0.75em（フォントサイズに追従、見やすいが邪魔にならない）
- **文字の丸**: 2em（十分に大きく視認性が高い）
- **下線の太さ**: 3px（視認性が高い）

#### フォントサイズへの追従

すべてのインジケータのサイズは `em` 単位で指定されており、ユーザーがフォントサイズを変更した際に自動的に追従します。これにより、視力の弱い方がフォントサイズを大きくした場合でも、インジケータも同じように拡大され、判別しやすさが保たれます。

## 実装の教訓

### CSS設計の原則

#### 避けるべき実装

- ❌ `position: absolute` + 固定値（`top: 23px` など）
- ❌ 固定サイズ（`width: 300px` など）
- ❌ 複雑な計算（`calc()` の乱用）

#### 推奨される実装

- ✅ Flexbox / Grid（自動調整）
- ✅ 相対単位（`em`, `rem`, `%`）
- ✅ シンプルな構造

### 今回の実装経験

1. **最初のアプローチ**: `position: absolute` + 複雑な計算 → **失敗**
2. **最終的な解決**: Flexbox + シンプルな構造 → **成功**

CSSは諸刃の剣であり、使い方を誤るとレスポンシブデザインとは相反して、固定したデザインになりかねません。常にシンプルで柔軟な実装を心がけることが重要です。

## 実装ファイル

### 変更したファイル

1. **res/css/menu.css**
   - インジケータのスタイル定義
   - Flexboxレイアウト
   - フォーカス状態のスタイル

2. **res/js/menu.js**
   - `setupLanguageMenu()` - activeクラスの追加
   - `setupAccessibilityIndicators()` - フォーカスリスナーの設定
   - input要素の自動ラッピング（Flexbox用）

## 使用方法

### 開発者向け

#### 新しいドロップダウンメニュー項目を追加する場合

```html
<div class="dropdown-item">項目名</div>
<div class="dropdown-item active">選択中の項目</div>
```

#### 新しいフォーム入力を追加する場合

```html
<div class="form-group">
    <label for="field-id">ラベル:</label>
    <input type="text" id="field-id" name="field-id" />
</div>
```

フォーカスインジケータは自動的に追加されます（`setupAccessibilityIndicators()`が実行されるため）。

#### 新しいボタンを追加する場合

```html
<button class="btn-primary focus-indicator">ボタン</button>
```

### ユーザー向け

#### 言語メニュー

- メニューを開くと、現在選択されている言語の前に**緑の塗りつぶしの丸（●）**が表示されます
- 他の言語は空の丸（○）が表示されます

#### フォーム入力

- フィールドにフォーカスすると、**左側に大きな緑の丸（●）**が表示されます
- フィールドの枠も緑色に変わります

#### ボタン

- ボタンにフォーカスすると、**下部に緑の下線**が表示されます
- 緑のアウトラインも表示されます

## テストと検証

### 実装済み機能の確認項目

以下の機能は実装済みで、動作確認済みです：

- [x] 言語メニューで選択言語に緑の丸（黒い縁取り付き）が表示される
- [x] 言語を切り替えると丸が移動する
- [x] フォーム入力にフォーカスすると緑の丸（黒い縁取り付き）が左側に表示される
- [x] フォーカスを外すと丸が消える
- [x] インジケータがフォントサイズの変更に追従する（em単位使用）
- [x] 色覚異常の方でも黒い縁取りにより形状で認識可能
- [x] Flexboxによる自動中央配置が機能する

### 今後の実装予定

以下の機能は未実装で、今後の実装予定です：

#### アクセシビリティ強化

- [ ] スクリーンリーダー対応（ARIA属性の追加）
  - `aria-label`、`aria-describedby` などの適切な設定
  - フォーカスイベントの音声通知
  
- [ ] 完全なキーボードナビゲーション
  - すべての機能をキーボードのみで操作可能に
  - ショートカットキーの追加
  - Tabキーの順序最適化

- [ ] フォーカスインジケータの更なる強化
  - ボタンのフォーカス時の下線表示（現在は定義済みだが要検証）
  - 他のインタラクティブ要素へのインジケータ追加

#### 将来的な拡張

- [ ] カスタマイズ可能なインジケータ
  - ユーザーが色やサイズを変更できる設定画面
  
- [ ] ハイコントラストモード
  - より強いコントラストのテーマ
  - 白黒反転モード

- [ ] アニメーション効果
  - インジケータの表示/非表示にフェードイン/アウト効果
  - `prefers-reduced-motion` メディアクエリ対応

### 色覚異常シミュレーションテスト（推奨）

実装済みの機能について、以下のシミュレーションツールでの確認を推奨します：

- [ ] 1型色覚（P型、赤色弱）シミュレーション
- [ ] 2型色覚（D型、緑色弱）シミュレーション
- [ ] 3型色覚（T型、青色弱）シミュレーション
- [ ] 全色盲（モノクロ視覚）シミュレーション
- [ ] グレースケール表示での確認

推奨ツール: [Color Blindness Simulator](https://www.color-blindness.com/coblis-color-blindness-simulator/)

## 参考資料

- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [WebAIM: Keyboard Accessibility](https://webaim.org/techniques/keyboard/)
- [Color Contrast Analyzer](https://developer.paciellogroup.com/resources/contrastanalyser/)
- [色覚バリアフリーガイドライン](https://jfly.uni-koeln.de/color/)
- [WebAIM: Color Blindness Simulator](https://www.color-blindness.com/coblis-color-blindness-simulator/)

## 統計情報

### 日本における色覚異常

- **男性**: 約5%（20人に1人）
- **女性**: 約0.2%（500人に1人）
- **合計**: 約300万人以上

この実装により、これらの方々により使いやすいアプリケーションを提供できます。

## 変更履歴

### 2024-10-24

- 初版作成
- 言語メニューのインジケータ実装
- フォーム入力のフォーカスインジケータ実装
- ボタンのフォーカスインジケータ実装
- インジケータサイズを `em` 単位に変更（フォントサイズに追従）
- すべてのインジケータがユーザーのフォントサイズ設定に追従するように改善
- 緑の丸に黒い縁取りを追加（色覚バリアフリー対応）
- 色に依存せず形状のコントラストで認識可能に改善
- Flexboxによる完璧な垂直中央配置を実装
