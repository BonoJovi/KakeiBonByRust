# 集計機能ユーザーガイド

**最終更新**: 2025-11-21 05:05 JST

## 目次

1. [概要](#概要)
2. [5つの集計方法](#5つの集計方法)
3. [共通機能](#共通機能)
4. [各集計画面の使い方](#各集計画面の使い方)
5. [集計結果の見方](#集計結果の見方)
6. [Tips & トラブルシューティング](#tips--トラブルシューティング)

---

## 概要

KakeiBonの集計機能では、入出金データを様々な軸で集計・分析できます。

### 集計機能でできること

- **期間別の収支分析**: 日次・週次・月次・年次・任意期間での集計
- **カテゴリ別分析**: 費目（大分類・中分類・小分類）ごとの集計
- **口座別分析**: 口座ごとの収支・残高推移
- **店舗別分析**: よく使う店舗の特定と支出管理

### 集計結果に表示される情報

各集計結果には以下の情報が表示されます：

- **グループ名**: カテゴリ名、口座名、店舗名など
- **合計金額（純増減）**: 収入は加算、支出は減算した純増減額
- **件数**: 該当する取引の件数
- **平均金額**: 合計金額を件数で割った平均額

---

## 5つの集計方法

KakeiBonでは、用途に応じて5つの集計方法を提供しています。

| 集計方法 | 用途 | 指定方法 |
|---------|------|---------|
| **月次集計** | 毎月の収支を確認 | 年・月を指定 |
| **日次集計** | 特定日の収支を確認 | 日付を指定 |
| **週次集計** | 週単位の収支を確認 | 基準日と週の開始曜日を指定 |
| **年次集計** | 年間収支・会計年度収支を確認 | 年と年度開始月を指定 |
| **期間別集計** | 任意期間の収支を確認 | 開始日と終了日を指定 |

### どの集計方法を選ぶべきか？

- **毎月の収支を確認したい** → **月次集計**
- **今日の収支を確認したい** → **日次集計**
- **今週の収支を確認したい** → **週次集計**
- **年間収支を確認したい** → **年次集計**（暦年: 1月開始、会計年度: 4月開始）
- **特定期間の収支を確認したい** → **期間別集計**（例: 10月1日〜11月20日）

---

## 共通機能

全ての集計画面で共通して利用できる機能です。

### 集計軸の選択

以下の5つの軸で集計できます：

1. **カテゴリ（大分類）** - 支出・収入・振替での集計
2. **カテゴリ（中分類）** - 食費・交通費などでの集計
3. **カテゴリ（小分類）** - 外食・自炊などでの集計
4. **口座** - 現金・銀行口座ごとの集計
5. **店舗** - コンビニ・スーパーなどでの集計

### フィルターパネルの開閉

各集計画面には、フィルターパネルがあります。

- **開く/閉じる**: 「フィルター」見出しをクリック、または右側の▲/▼ボタンをクリック
- 閉じた状態でも実行ボタンは表示されます

### 実行方法

1. 期間を指定
2. 集計軸（カテゴリ/口座/店舗）を選択
3. 「実行」ボタンをクリック

※ 日付入力欄でEnterキーを押しても実行できます

---

## 各集計画面の使い方

### 1. 月次集計

**画面**: メニュー → 管理 → 月次集計

#### 操作方法

1. **年の選択**
   - 年の右側にある ↑↓ ボタンで年を変更
   - または数値を直接入力

2. **月の選択**
   - 月のドロップダウンから1〜12月を選択

3. **集計軸の選択**
   - 「集計単位」ドロップダウンからカテゴリ/口座/店舗を選択

4. **実行**
   - 「実行」ボタンをクリック

#### デフォルト設定

- 年: 現在の年
- 月: 現在の月
- 集計単位: カテゴリ（大分類）

---

### 2. 日次集計

**画面**: メニュー → 管理 → 日次集計

#### 操作方法

1. **日付の選択**
   - カレンダーアイコンをクリックしてカレンダーから選択
   - または日付を直接入力（YYYY-MM-DD形式）

2. **集計軸の選択**
   - 「集計単位」ドロップダウンからカテゴリ/口座/店舗を選択

3. **実行**
   - 「実行」ボタンをクリック、またはEnterキー

#### デフォルト設定

- 日付: 今日
- 集計単位: カテゴリ（大分類）

---

### 3. 週次集計

**画面**: メニュー → 管理 → 週次集計

#### 操作方法

1. **基準日の選択**
   - カレンダーから日付を選択
   - その週の任意の日付を選択すればOK（月曜でなくてもOK）

2. **週の開始曜日の選択**
   - 「日曜」または「月曜」を選択
   - 日本では一般的に月曜始まりが多い

3. **集計軸の選択**
   - 「集計単位」ドロップダウンからカテゴリ/口座/店舗を選択

4. **実行**
   - 「実行」ボタンをクリック

#### 週の範囲の計算方法

- **月曜始まり**: 基準日を含む週の月曜〜日曜
- **日曜始まり**: 基準日を含む週の日曜〜土曜

例: 基準日が2025年11月20日（木曜）の場合
- 月曜始まり: 2025/11/17（月）〜 2025/11/23（日）
- 日曜始まり: 2025/11/16（日）〜 2025/11/22（土）

#### デフォルト設定

- 基準日: 今日
- 週の開始曜日: 月曜
- 集計単位: カテゴリ（大分類）

---

### 4. 年次集計

**画面**: メニュー → 管理 → 年次集計

#### 操作方法

1. **年の選択**
   - 年の右側にある ↑↓ ボタンで年を変更
   - または数値を直接入力

2. **年度開始月の選択**
   - 「1月（暦年）」: 1月1日〜12月31日
   - 「4月（会計年度）」: 4月1日〜翌年3月31日

3. **集計軸の選択**
   - 「集計単位」ドロップダウンからカテゴリ/口座/店舗を選択

4. **実行**
   - 「実行」ボタンをクリック

#### 年度の考え方

- **暦年（Calendar Year）**: 1月〜12月の一般的な年
- **会計年度（Fiscal Year）**: 日本の会計年度（4月〜翌年3月）

例: 年=2025、年度開始月=4月の場合
- 集計期間: 2025年4月1日 〜 2026年3月31日（FY2025）

#### デフォルト設定

- 年: 現在の年
- 年度開始月: 1月（暦年）
- 集計単位: カテゴリ（大分類）

---

### 5. 期間別集計

**画面**: メニュー → 管理 → 期間別集計

#### 操作方法

1. **開始日の選択**
   - カレンダーから開始日を選択

2. **終了日の選択**
   - カレンダーから終了日を選択

3. **集計軸の選択**
   - 「集計単位」ドロップダウンからカテゴリ/口座/店舗を選択

4. **実行**
   - 「実行」ボタンをクリック

#### バリデーション

- 開始日は終了日より前である必要があります
- 未来の日付は指定できません

#### デフォルト設定

- 開始日: 今月1日
- 終了日: 今日
- 集計単位: カテゴリ（大分類）

#### 使用例

- **直近1週間の収支**: 7日前 〜 今日
- **四半期の収支**: 10月1日 〜 12月31日
- **旅行期間の収支**: 11月1日 〜 11月5日

---

## 集計結果の見方

### 結果テーブルの構成

集計結果は以下のような表形式で表示されます：

| グループ名 | 合計金額（純増減） | 件数 | 平均金額 |
|-----------|------------------|------|---------|
| 食費 | -50,000円 | 30件 | -1,667円 |
| 給料 | +300,000円 | 1件 | +300,000円 |

### 金額の表示ルール

- **プラス（+）**: 収入（資産の増加）
- **マイナス（-）**: 支出（資産の減少）
- **純増減**: 収入と支出を合算した純増減額

### 振替の扱い

#### 一般的な集計（カテゴリ/店舗）

振替取引（口座間移動）は**金額が常に0円**になるため、結果には表示されません。

理由: 振替は資産全体の増減がないため、集計から除外されます。

#### 口座別集計

口座別集計では、振替取引が含まれます。

- **FROM口座（送金元）**: マイナス表示
- **TO口座（送金先）**: プラス表示

**注記**: 画面下部に「※口座別集計には振替分が含まれます」と表示されます。

---

## Tips & トラブルシューティング

### よくある質問

#### Q1. データが表示されない

**原因と対策**:
1. 指定期間にデータが存在しない → 期間を変更してみる
2. フィルタが厳しすぎる → 集計単位を変更してみる
3. データベースに入出金データが未登録 → 先に入出金管理でデータを登録

#### Q2. 金額がマイナスばかりになる

支出が多い場合、ほとんどの項目がマイナス表示になります。

- **家計改善のヒント**: マイナス金額の大きい項目から見直すと効果的

#### Q3. 口座別集計の金額が他と違う

口座別集計では振替取引が含まれるため、他の集計軸と結果が異なります。

- カテゴリ別: 振替除外（純粋な収支のみ）
- 口座別: 振替含む（口座間の資金移動も表示）

#### Q4. 週次集計の範囲が分かりにくい

基準日を含む週の範囲が自動計算されます。

**確認方法**: 実行後、コンソールログに実際の集計期間が表示されます（開発者ツール → Console）

---

### パフォーマンス Tips

#### 大量データがある場合

- **期間を短く**: 月次より日次、年次より月次のほうが高速
- **集計軸を単純に**: 小分類より大分類のほうが高速

#### 表示が遅い場合

- ブラウザのキャッシュをクリア
- データベースの最適化（将来機能として実装予定）

---

### キーボードショートカット

- **Enter**: 日付入力後に実行
- **Tab**: フィールド間の移動
- **Esc**: モーダルを閉じる（該当する場合）

---

## 今後の機能拡張予定

現在実装中・計画中の機能：

- [ ] グラフ表示（棒グラフ・円グラフ・折れ線グラフ）
- [ ] CSVエクスポート
- [ ] 複合フィルタ（金額範囲、キーワード検索）
- [ ] 商品別・メーカー別集計
- [ ] 予算vs実績比較

---

## 関連ドキュメント

- [集計APIリファレンス](API_AGGREGATION.md) - 開発者向けAPI仕様
- [入出金管理ガイド](TRANSACTION_MANAGEMENT_UI_V2.md) - データ入力方法
- [カテゴリ管理ガイド](CATEGORY_MANAGEMENT_UI.md) - 費目の設定方法

---

**Last Updated**: 2025-11-21 05:05 JST
